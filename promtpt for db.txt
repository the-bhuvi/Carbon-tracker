1. DATABASE SCHEMA DESIGN

Create the following tables:

1Ô∏è‚É£ users

id (uuid, primary key, default uuid_generate_v4())

name (text)

email (text, unique)

role (text: 'student' or 'admin')

department_id (uuid, foreign key)

created_at (timestamp default now())

2Ô∏è‚É£ departments

id (uuid primary key)

name (text unique)

building_area_sqft (numeric)

student_count (int)

created_at (timestamp default now())

3Ô∏è‚É£ carbon_submissions

id (uuid primary key)

user_id (uuid, foreign key)

department_id (uuid, foreign key)

electricity_kwh (numeric)

diesel_liters (numeric)

petrol_liters (numeric)

travel_km (numeric)

waste_kg (numeric)

water_liters (numeric)

calculated_total_carbon (numeric)

carbon_score (text)

tree_equivalent (numeric)

suggestions (text)

created_at (timestamp default now())

4Ô∏è‚É£ emission_factors

id (uuid primary key)

factor_name (text)

factor_value (numeric)

unit (text)

last_updated (timestamp)

Insert default factors:

electricity = 0.82

diesel = 2.68

petrol = 2.31

travel_km = 0.192

waste_kg = 1.2

water_liter = 0.0003

üü¢ 2. CREATE CALCULATION FUNCTION

Create PostgreSQL function:

calculate_carbon()

It should:

Fetch emission factors dynamically

Calculate total carbon:
electricity * factor +
diesel * factor +
petrol * factor +
travel * factor +
waste * factor +
water * factor

Compute carbon_score:
< 500 ‚Üí Green
500‚Äì1500 ‚Üí Moderate

1500 ‚Üí High

Calculate tree_equivalent:
total_carbon / 21

Generate suggestions:
If electricity high ‚Üí suggest solar
If travel high ‚Üí suggest carpooling
If waste high ‚Üí suggest recycling

Return:

total_carbon

carbon_score

tree_equivalent

suggestions

üü¢ 3. TRIGGERS

Create a trigger:

Before insert on carbon_submissions:

Automatically:

Call calculate_carbon()

Store computed values

üü¢ 4. ROLE-BASED ACCESS CONTROL (RLS)

Enable Row Level Security.

Rules:

Students:

Can insert submissions

Can view their own submissions

Admins:

Can view all submissions

Can view aggregated reports

üü¢ 5. DASHBOARD QUERIES

Create SQL views for dashboard:

View 1: department_emission_summary

Group by department:

total_carbon

avg_carbon

total_submissions

View 2: monthly_emission_trend

Group by:

month

year

sum(total_carbon)

View 3: role_based_summary

Group by role:

total emissions

submission count

These views must be optimized for charts.

üü¢ 6. MOCK DATA GENERATION

Insert:

5 departments

2 admins

20 students

200 carbon_submissions over last 6 months

Random but realistic values

Distributed across departments

Varying carbon levels

Mock data must create:

Visible trend increase/decrease

Department comparison difference

Students with repeated submissions

Historical tracking capability

üü¢ 7. HISTORY TRACKING

Ensure:

Every submission stored with timestamp

No overwrite allowed

Support filtering by:

department

user

date range

month

üü¢ 8. PERFORMANCE OPTIMIZATION

Add indexes:

department_id

user_id

created_at

üü¢ 9. OUTPUT REQUIREMENTS

Provide:

All SQL migration scripts

RLS policies

Trigger functions

Mock data insert scripts

Supabase CLI setup instructions

Folder structure for migrations

Instructions to deploy using Supabase CLI

Example API calls from frontend

üü¢ 10. EXTRA ACCURACY IMPROVEMENTS

Add:

Weighted carbon adjustment based on building area

Per capita emission calculation

Emission intensity per sqft

Comparison vs previous month

Deliver everything production-ready.